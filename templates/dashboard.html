<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Dashboard - Traffic Signs Analysis</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .header-dash { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; padding: 30px 0; border-bottom: 5px solid #3498db; margin-bottom: 30px; }
        .card { border: none; border-radius: 15px; box-shadow: 0 6px 12px rgba(0,0,0,0.08); transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); }
        .stat-value { font-size: 2.5rem; font-weight: bold; color: #2c3e50; }
        .chart-container { position: relative; height: 300px; width: 100%; }
    </style>
</head>
<body>

<div class="header-dash text-center">
    <div class="container">
        <h1>Tableau de Bord Personnel : {{ username }}</h1>
        <p class="lead">Analyse dynamique de vos détections d'Intelligence Artificielle</p>
        <a href="{{ url_for('index') }}" class="btn btn-outline-light">Nouveau Scan</a>
    </div>
</div>

<div class="container pb-5">
    <div class="row text-center mb-4">
        <div class="col-md-6">
            <div class="card p-4">
                <div class="stat-value">{{ user_total }}</div>
                <div class="text-muted">Mes Détections</div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card p-4">
                <div class="stat-value">{{ global_total }}</div>
                <div class="text-muted">Total Application (Tous utilisateurs)</div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-7">
            <div class="card p-4 h-100">
                <h5 class="mb-3 text-primary">Top 5 des Panneaux Identifiés</h5>
                <div class="chart-container">
                    <canvas id="barChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="card p-4 h-100">
                <h5 class="mb-3 text-primary">Répartition par Classe</h5>
                <div class="chart-container">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="card p-4">
                <h5 class="mb-3 text-primary">Évolution Temporelle de l'Activité</h5>
                <div class="chart-container" style="height: 250px;">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Configuration commune des couleurs
    const colors = ['#3498db', '#2ecc71', '#e74c3c', '#f1c40f', '#9b59b2'];

    // 1. BAR CHART
    new Chart(document.getElementById('barChart'), {
        type: 'bar',
        data: {
            labels: {{ labels|tojson }},
            datasets: [{
                label: 'Nombre de scans',
                data: {{ values|tojson }},
                backgroundColor: colors[0],
                borderRadius: 8
            }]
        },
        options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
    });

    // 2. PIE CHART
    new Chart(document.getElementById('pieChart'), {
        type: 'doughnut', // 'pie' ou 'doughnut'
        data: {
            labels: {{ labels|tojson }},
            datasets: [{
                data: {{ values|tojson }},
                backgroundColor: colors
            }]
        },
        options: { maintainAspectRatio: false }
    });

    // 3. LINE CHART
    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: {{ evo_labels|tojson }},
            datasets: [{
                label: 'Scans quotidiens',
                data: {{ evo_values|tojson }},
                borderColor: '#2c3e50',
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                fill: true,
                tension: 0.3
            }]
        },
        options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } }
    });
</script>

</body>
</html>